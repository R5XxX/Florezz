<!doctype html>

<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Página móvil - una sola archivo</title>
  <style>
    :root{--btn-bg:#fcfcec;--btn-text:#000;}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{background-image:url('https://i.imgur.com/umhxdOx.jpeg');background-size:cover;background-position:center;display:flex;flex-direction:column}
    .safe-area{padding:env(safe-area-inset-top,12px) 12px 12px;display:flex;flex-direction:column;flex:1}/* Texto superior */
.top-wrap{width:100%;display:flex;justify-content:flex-start;align-items:flex-start;}
.typing-box{max-width:96%;white-space:pre-line}
.typing-text{display:inline-block;font-style:italic;letter-spacing:1px;line-height:1.3; 
  font-size:clamp(26px,8vw,42px);color:#111;text-shadow:0 1px 0 rgba(255,255,255,0.6)}

/* Botón inferior dentro de la imagen */
.bottom-area{margin-top:auto;display:flex;justify-content:center;padding:18px}
.btn{
  background:var(--btn-bg);color:var(--btn-text);border-radius:18px;border:3px solid #000;padding:12px 18px;font-weight:700;font-size:18px;box-shadow:0 0 0 rgba(252,252,236,0);transition:box-shadow .25s,transform .12s;touch-action:manipulation
}
.btn.glow{animation:glow 1.2s ease-in-out infinite}
@keyframes glow{0%{box-shadow:0 0 0 rgba(0,0,0,0)}50%{box-shadow:0 6px 24px rgba(252,252,236,0.9);transform:translateY(-2px)}100%{box-shadow:0 0 0 rgba(0,0,0,0)}}

/* Emoticons falling */
.emoji{position:fixed;z-index:60;font-size:26px;pointer-events:none;user-select:none}

/* Modal / cuadro central */
.modal{position:fixed;inset:6% 6%;background:var(--btn-bg);border:4px solid #000;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;padding:12px;box-sizing:border-box}
.modal.hidden{display:none}
.countdown{font-size:clamp(28px,10vw,56px);font-weight:800;margin:8px;text-align:center}
.video-wrap{width:100%;flex:1;display:flex;align-items:center;justify-content:center}
video{width:100%;height:auto;max-height:60vh;border:3px solid #000;background:#000}

/* repetir button */
.repeat{margin-top:10px}

*{box-sizing:border-box}

  </style>
</head>
<body>
  <div class="safe-area">
    <div class="top-wrap">
      <div class="typing-box" id="typingBox">
        <span class="typing-text" id="typingText"></span>
      </div>
    </div><div class="bottom-area">
  <button id="mainBtn" class="btn" aria-hidden="true">𝑫𝒂𝒎𝒆 𝒄𝒍𝒊𝒄𝒌𝒌</button>
</div>

  </div>  <div id="modal" class="modal hidden" role="dialog" aria-modal="true">
    <div id="modalInner">
      <div id="countdown" class="countdown">5</div>
      <div id="videoArea" class="video-wrap" style="display:none">
        <video id="mainVideo" loop playsinline muted></video>
      </div>
      <div style="width:100%;display:flex;justify-content:center">
        <button id="repeatBtn" class="btn repeat" style="display:none">repetir</button>
      </div>
    </div>
  </div><audio id="bgAudio" loop preload="auto" src="https://www.dropbox.com/scl/fi/c8682aezsuvkfmwcdixd1/Eres_mixed.mp3?rlkey=bs0i3nubrleqn7ql1xx6ctk9n&dl=1"></audio>

  <script>
    const textToType = '𝑯𝒐𝒍𝒂 𝑱𝒐𝒄𝒆𝒍𝒊𝒏𝒄𝒊𝒕𝒂 𝒃𝒐𝒏𝒊𝒕𝒂\n𝒑𝒂𝒓𝒂 𝒕𝒊 🫶🏼';
    const typingTextEl = document.getElementById('typingText');
    const btn = document.getElementById('mainBtn');
    const audio = document.getElementById('bgAudio');
    const modal = document.getElementById('modal');
    const countdownEl = document.getElementById('countdown');
    const video = document.getElementById('mainVideo');
    const videoSrc = 'https://i.imgur.com/uYiwYzE.mp4';
    const repeatBtn = document.getElementById('repeatBtn');
    let typingDone = false;

    function spawnEmoji(xPercent, emoji, duration=3000){
      const el = document.createElement('div');
      el.className = 'emoji';
      el.style.left = xPercent + '%';
      el.style.top = '-6vh';
      el.style.fontSize = (20 + Math.random()*24) + 'px';
      el.textContent = emoji;
      document.body.appendChild(el);
      el.animate([
        { transform: `translateY(0) rotate(0deg)`, opacity:1 },
        { transform: `translateY(110vh) rotate(360deg)`, opacity:0 }
      ], { duration, easing:"linear" });
      setTimeout(()=>el.remove(), duration);
    }

    function spawnFallingEmojisBurst(count=10, duration=3000){
      const emojis = ['🏵','🌼'];
      for(let i=0;i<count;i++){
        const left = Math.random()*100;
        const emoji = emojis[Math.floor(Math.random()*emojis.length)];
        setTimeout(()=>spawnEmoji(left,emoji,duration), Math.random()*300);
      }
    }

    async function typeWriter(){
      typingTextEl.textContent = '';
      const chars = Array.from(textToType);
      for(let i=0;i<chars.length;i++){
        typingTextEl.textContent += chars[i];
        await new Promise(r=>setTimeout(r, 80));
      }
      typingDone = true;
      try{ await audio.play(); }catch(e){}
      btn.classList.add('glow');
      spawnFallingEmojisBurst(15,3000);
    }

    function resetAll(){
      modal.classList.add('hidden');
      document.querySelectorAll('.emoji').forEach(e=>e.remove());
      repeatBtn.style.display='none';
      document.getElementById('videoArea').style.display='none';
      video.pause();video.removeAttribute('src');video.load();
      countdownEl.style.display='block';
      countdownEl.textContent='5';
      btn.style.display='flex';
      btn.disabled=false;
      btn.classList.remove('glow');
      typingDone=false;
      audio.currentTime=0;
      typeWriter();
    }

    btn.addEventListener('click', async function(){
      if(!typingDone) return;
      try{ await audio.play(); }catch(e){}
      btn.classList.remove('glow');
      spawnFallingEmojisBurst(10,3000);
      modal.classList.remove('hidden');
      let time = 5;
      countdownEl.textContent = time;
      const emojiInterval = setInterval(()=>{
        const x = Math.random()*100;
        const e = Math.random()>0.5?'🏵':'🌼';
        spawnEmoji(x,e,2500);
      }, 200);
      const timerInterval = setInterval(()=>{
        time--;
        if(time>=0) countdownEl.textContent = time;
        if(time<0){
          clearInterval(timerInterval);
          clearInterval(emojiInterval);
          showVideoAndRepeat();
        }
      }, 1000);
    });

    function showVideoAndRepeat(){
      countdownEl.style.display='none';
      const videoArea = document.getElementById('videoArea');
      videoArea.style.display='flex';
      video.src = videoSrc;
      video.loop = true;
      video.muted = false;
      video.play().catch(()=>{});
      repeatBtn.style.display='inline-block';
      repeatBtn.onclick = ()=>{ audio.currentTime=0; audio.play().catch(()=>{}); resetAll(); };
    }

    (function init(){
      btn.style.display='none';
      typeWriter().then(()=>{ btn.style.display='inline-block'; });
      document.addEventListener('click', async function onFirstClick(){
        if(audio.paused){ try{ await audio.play(); }catch(e){} }
      }, {once:true});
    })();
  </script></body>
</html>
